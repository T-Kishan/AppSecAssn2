using System.Security.Cryptography;
using System.Text;

namespace AppSecAssignment.Services
{
    public class DigitalSignature
    {

        private static RSACryptoServiceProvider rsa;
        private static string _privateKey;
        private static string _publicKey;

        static DigitalSignature()
        {
            rsa = new RSACryptoServiceProvider(2048);
            _privateKey = rsa.ToXmlString(true); // Contains the secret
            _publicKey = rsa.ToXmlString(false); // Public info only
        }

        // 1. Create the Signature (Sign Data)
        public static string SignData(string dataToSign)
        {
            byte[] bytes = Encoding.UTF8.GetBytes(dataToSign);

            // Hash the data first, then sign the hash
            byte[] signature = rsa.SignData(bytes, HashAlgorithmName.SHA256, RSASignaturePadding.Pkcs1);

            return Convert.ToBase64String(signature);
        }

        // 2. Verify the Signature (Check if data was tampered)
        public static bool VerifyData(string originalData, string signatureFromDb)
        {
            byte[] bytesToVerify = Encoding.UTF8.GetBytes(originalData);
            byte[] signatureBytes = Convert.FromBase64String(signatureFromDb);

            return rsa.VerifyData(bytesToVerify, signatureBytes, HashAlgorithmName.SHA256, RSASignaturePadding.Pkcs1);
        }
    }
}